â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MEMO - DUEL ISOMETRIES - STATE & NEXT STEPS
Date: 2025-12-05
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ¯ OBJECTIF GLOBAL
CrÃ©er un mode "Duel IsomÃ©tries" oÃ¹ 2 joueurs reconstituisent 
un mÃªme puzzle 5Ã—5 (ou 4Ã—5, 3Ã—5) avec des piÃ¨ces pentomino.

Architecture:
- Serveur: Chef d'orchestre (synchronise)
- Clients: Musiciens (gÃ©nÃ¨rent plateaux + jouent)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## âœ… CE QUI MARCHE

1. **CRÃ‰ATION**
   - Ã‰cran avec sÃ©lecteur taille (3Ã—5, 4Ã—5, 5Ã—5) âœ…
   - GÃ©nÃ©ration triplette: (taille, configIndex, solutionNum) âœ…
   - POST /room/create avec triplette âœ…

2. **SERVEUR CLOUDFLARE**
   - Route vers DUEL_ISOMETRY_ROOM âœ…
   - Stocke triplette via /init âœ…
   - Broadcast aux 2 joueurs via WebSocket âœ…
   - duel-isometry-room.ts: 200 lignes, complet âœ…

3. **CLIENTS**
   - Master voit plateau 5Ã—5 âœ…
   - Guest rejoint, reÃ§oit triplette âœ…
   - Guest gÃ©nÃ¨re plateau identique via PentoscopeSolver âœ…
   - Guest voit plateau 5Ã—5 âœ…

4. **SYNCHRONISATION**
   - Messages WebSocket fonctionnent âœ…
   - Ã‰tat partagÃ© via provider âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## âŒ CE QUI MANQUE - PRIORITÃ‰

### 1. SLIDERS & INTERACTIONS (CRITIQUE)
   - Importer/adapter duel/widgets/duel_piece_slider.dart
   - Adapter pour grille 5Ã—5 (au lieu de 6Ã—10)
   - DÃ©tection collision avec autres piÃ¨ces
   - Feedback visuel (couleurs, highlights)
   
   Fichiers Ã  adapter:
   - ~/StudioProjects/pentapol/lib/duel/widgets/duel_piece_slider.dart
   - ~/StudioProjects/pentapol/lib/duel_isometry/widgets/

### 2. VALIDATION PLACEMENTS
   - CrÃ©er DuelIsometryValidator
   - Valider que piÃ¨ce ne sort pas grille
   - Valider pas d'overlap avec autres piÃ¨ces
   - Envoyer au serveur via WebSocket
   
   Message: { type: "placePiece", pieceId, x, y, orientation }

### 3. COUNTDOWN AVANT JEU
   - Quand gameStart reÃ§u: afficher 3, 2, 1
   - Passer gameState Ã  "playing" Ã  0
   - Activer sliders une fois playing

### 4. FIN DE JEU
   - DÃ©tection plateau complÃ¨tement rempli
   - ArrÃªter le temps
   - Afficher gagnant / scoreboards
   - Message gameEnd au serveur

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“ FICHIERS CLÃ‰S

### Flutter (~/StudioProjects/pentapol/lib/)

duel_isometry/
  â”œâ”€â”€ screens/
  â”‚   â”œâ”€â”€ duel_isometry_create_screen.dart (CREATE - complet âœ…)
  â”‚   â”œâ”€â”€ duel_isometry_join_screen.dart (JOIN - complet âœ…)
  â”‚   â”œâ”€â”€ duel_isometry_waiting_screen.dart (AFFICHE PLATEAU âœ…)
  â”‚   â”œâ”€â”€ duel_isometry_game_screen.dart (TODO - crÃ©er/adapter)
  â”‚   â””â”€â”€ duel_isometry_home_screen.dart (MENU - complet âœ…)
  â”‚
  â”œâ”€â”€ models/
  â”‚   â”œâ”€â”€ duel_isometry_state.dart (avec plateau âœ…)
  â”‚   â””â”€â”€ duel_isometry_messages.dart (parsing messages âœ…)
  â”‚
  â”œâ”€â”€ providers/
  â”‚   â”œâ”€â”€ duel_isometry_provider.dart (core logic âœ…)
  â”‚   â”œâ”€â”€ _generatePlateauFromTriple() (SOLVER âœ…)
  â”‚   â””â”€â”€ _handleGameStart() (gÃ©nÃ¨re plateau âœ…)
  â”‚
  â””â”€â”€ widgets/
      â”œâ”€â”€ duel_isometry_plateau_widget.dart (AFFICHE GRILLE âœ…)
      â”œâ”€â”€ duel_isometry_piece_slider.dart (TODO - crÃ©er)
      â””â”€â”€ ...

pentoscope/
  â”œâ”€â”€ pentoscope_data.dart (1084 configs: 3Ã—5, 4Ã—5, 5Ã—5 âœ…)
  â”œâ”€â”€ pentoscope_solver.dart (BACKTRACKING âœ…)
  â””â”€â”€ pentoscope_generator.dart (genÃ¨re configs alÃ©atoires âœ…)

models/
  â”œâ”€â”€ plateau.dart (grid[y][x] = pieceId âœ…)
  â””â”€â”€ pentominos.dart (12 piÃ¨ces + orientations âœ…)

### Serveur TypeScript (~/StudioProjects/pentapol-server/src/)

index.ts
  - POST /room/create: reÃ§oit triplette âœ…
  - GET /room/:code/exists âœ…
  - WebSocket routing âœ…

duel-isometry-room.ts (COMPLET)
  - Class DuelIsometryRoom (Durable Object)
  - handleCreateRoom() âœ…
  - handleJoinRoom() + broadcast triplette âœ…
  - startGame() âœ…
  - handlePlacePiece() âœ…
  - broadcast() âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ”§ NEXT SESSION ROADMAP

### PHASE 1: INPUT (1-2h)
- Adapter sliders pour grille 5Ã—5
- ImplÃ©menter DuelIsometryValidator
- Tester placements locaux

### PHASE 2: SYNC (1h)
- Envoyer placements au serveur via "placePiece"
- Serveur broadcast Ã  l'autre joueur
- Les 2 voient placements en temps rÃ©el

### PHASE 3: GAME FLOW (1-2h)
- Countdown avant dÃ©marrage
- Disable sliders avant countdown
- DÃ©tection fin de jeu
- Affichage rÃ©sultats

### PHASE 4: POLISH (30min)
- Animations
- Sounds
- Erreurs gracieuses

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ› BUGS CONNUS

Aucun connu actuellement !

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“ COMMANDES UTILES

Flutter:
```bash
cd ~/StudioProjects/pentapol
flutter analyze 2>&1 | grep "error â€¢" | wc -l
flutter run
```

Serveur:
```bash
cd ~/StudioProjects/pentapol-server
wrangler deploy
wrangler tail
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ¯ LOGS Ã€ CHERCHER

Master crÃ©e:
  [DUEL-ISO] Triple: taille=2, config=..., solution=...
  [DUEL-ISO] Plateau crÃ©Ã©: 5Ã—5

Guest rejoint:
  [DUEL-ISO] GÃ©nÃ©ration puzzle
  [DUEL-ISO] âœ… Plateau crÃ©Ã©: 5Ã—5

Serveur:
  [DUEL-ISO roomCode] Triple stockÃ©e
  (pas beaucoup de logs, c'est normal)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ’¡ NOTES ARCH

- PentoscopeSolver: backtracking, trouve Solution rapidement (<100ms)
- Plateau: List<List<int>> grid[y][x] = pieceId (0=libre)
- State: duel_isometry_provider.notifier pour mettre Ã  jour
- WebSocket: JSON messages avec types string
- Cloudflare Workers: 2 Durable Objects (DUEL_ROOM + DUEL_ISOMETRY_ROOM)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸš€ QUICK START PROCHAINE FOIS

1. Ouvrir ce mÃ©mo
2. Adapter duel_piece_slider.dart
3. ImplÃ©menter placePiece message
4. Tester sur 2 iPhones
5. Affiner UX

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
