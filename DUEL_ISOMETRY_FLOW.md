# Duel Isometry - Flux de Navigation

> Document gÃ©nÃ©rÃ© le 6 dÃ©cembre 2025

## Vue d'ensemble

Ce document trace le parcours complet depuis qu'un joueur rejoint une partie jusqu'Ã  l'affichage du plateau avec le sÃ©lecteur de piÃ¨ces.

---

## ğŸ“ Fichiers impliquÃ©s

| Fichier | RÃ´le |
|---------|------|
| `screens/duel_isometry_join_screen.dart` | Ã‰cran de saisie code + pseudo |
| `screens/duel_isometry_waiting_screen.dart` | Ã‰cran d'attente du 2e joueur |
| `screens/duel_isometry_game_screen.dart` | Ã‰cran de jeu principal |
| `providers/duel_isometry_provider.dart` | Logique mÃ©tier + WebSocket |
| `models/duel_isometry_state.dart` | Ã‰tat de la partie |
| `widgets/duel_isometry_plateau.dart` | Widget plateau de jeu |
| `widgets/duel_isometry_piece_slider.dart` | Widget sÃ©lecteur de piÃ¨ces |

---

## ğŸ”„ Phase 1 : Rejoindre une partie

### DuelJoinScreen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DuelJoinScreen                                             â”‚
â”‚  (duel_isometry_join_screen.dart)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  User: Entre code "AB12" + pseudo "Max"                     â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚  _joinRoom() appelÃ©                                         â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€ if (!_formKey.validate()) return                   â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€ settingsProvider.setDuelPlayerName(name)           â”‚
â”‚       â”‚                                                     â”‚
â”‚       â””â”€ duelIsometryProvider.notifier.joinRoom(code, name) â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚          [Voir Provider ci-dessous]                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DuelIsometryNotifier.joinRoom()

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DuelIsometryNotifier.joinRoom(roomCode, playerName)                    â”‚
â”‚  (duel_isometry_provider.dart:138)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1. state = state.copyWith(connectionState: connecting)                 â”‚
â”‚                                                                         â”‚
â”‚  2. HTTP GET /room/$roomCode/exists                                     â”‚
â”‚     â”‚                                                                   â”‚
â”‚     â”œâ”€ if (statusCode != 200)                                           â”‚
â”‚     â”‚     â†’ state.copyWith(connectionState: error)                      â”‚
â”‚     â”‚     â†’ return false                                                â”‚
â”‚     â”‚                                                                   â”‚
â”‚     â””â”€ if (checkData['exists'] != true)                                 â”‚
â”‚           â†’ state.copyWith(errorMessage: "Code invalide...")            â”‚
â”‚           â†’ return false                                                â”‚
â”‚                                                                         â”‚
â”‚  3. _wsService = DuelIsometryWebSocketService(wsUrl)                    â”‚
â”‚                                                                         â”‚
â”‚  4. _messageSubscription = _wsService.messages.listen(_onServerMessage) â”‚
â”‚                                                                         â”‚
â”‚  5. _connectionSubscription = _wsService.connectionState.listen(...)    â”‚
â”‚                                                                         â”‚
â”‚  6. await _wsService.connect()                                          â”‚
â”‚     â”‚                                                                   â”‚
â”‚     â””â”€ if (!connected)                                                  â”‚
â”‚           â†’ state.copyWith(errorMessage: "Impossible de se connecter")  â”‚
â”‚           â†’ return false                                                â”‚
â”‚                                                                         â”‚
â”‚  7. _wsService.send(JoinRoomMessage(roomCode, playerName))              â”‚
â”‚                                                                         â”‚
â”‚  8. state = state.copyWith(                                             â”‚
â”‚        roomCode: roomCode,                                              â”‚
â”‚        gameState: DuelGameState.waiting,    â† âœ… Ã‰TAT: WAITING          â”‚
â”‚        connectionState: connected                                       â”‚
â”‚     )                                                                   â”‚
â”‚                                                                         â”‚
â”‚  9. return true                                                         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Navigation vers WaitingScreen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Retour dans DuelJoinScreen._joinRoom()                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  if (mounted) {                                             â”‚
â”‚    Navigator.pushReplacement(                               â”‚
â”‚      context,                                               â”‚
â”‚      MaterialPageRoute(                                     â”‚
â”‚        builder: (context) => DuelIsometryWaitingScreen()    â”‚
â”‚      )                                                      â”‚
â”‚    );                                                       â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Phase 2 : Ã‰cran d'attente

### DuelIsometryWaitingScreen.build()

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DuelIsometryWaitingScreen.build()                                      â”‚
â”‚  (duel_isometry_waiting_screen.dart)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  final state = ref.watch(duelIsometryProvider)                          â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  CONDITION DE TRANSITION VERS LE JEU                            â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  if (state.plateau != null &&                                   â”‚    â”‚
â”‚  â”‚      (state.gameState == DuelGameState.countdown ||             â”‚    â”‚
â”‚  â”‚       state.gameState == DuelGameState.playing))                â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  â†’ return DuelIsometryGameScreenContent(state)                  â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  âœ… TRANSITION AUTOMATIQUE VERS L'Ã‰CRAN DE JEU                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  SINON: Affiche Ã©cran d'attente                                         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Scaffold(                                                      â”‚    â”‚
â”‚  â”‚    appBar: "Duel IsomÃ©tries"                                    â”‚    â”‚
â”‚  â”‚    body: Column([                                               â”‚    â”‚
â”‚  â”‚      CircularProgressIndicator,                                 â”‚    â”‚
â”‚  â”‚      "Code: ${state.roomCode}",                                 â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚      if (state.opponent != null)                                â”‚    â”‚
â”‚  â”‚        "${opponent.name} a rejoint !"                           â”‚    â”‚
â”‚  â”‚      else                                                       â”‚    â”‚
â”‚  â”‚        "En attente du 2e joueur...",                            â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚      if (state.plateau != null)                                 â”‚    â”‚
â”‚  â”‚        "Plateau gÃ©nÃ©rÃ©, dÃ©marrage...",                          â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚      ElevatedButton("Annuler")                                  â”‚    â”‚
â”‚  â”‚    ])                                                           â”‚    â”‚
â”‚  â”‚  )                                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Phase 3 : Messages WebSocket du serveur

### _onServerMessage() - Routage des messages

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _onServerMessage(ServerMessage message)                                â”‚
â”‚  (duel_isometry_provider.dart:585)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  switch (message) {                                                     â”‚
â”‚                                                                         â”‚
â”‚    RoomJoinedMessage    â†’ _handleRoomJoined()                           â”‚
â”‚    PlayerJoinedMessage  â†’ _handlePlayerJoined()                         â”‚
â”‚    GameStartMessage     â†’ _handleGameStart()      â† âœ… GÃ‰NÃˆRE PLATEAU   â”‚
â”‚    CountdownMessage     â†’ _handleCountdown()      â† âœ… 3, 2, 1, GO!     â”‚
â”‚    PiecePlacedMessage   â†’ _handlePiecePlaced()                          â”‚
â”‚    GameEndMessage       â†’ _handleGameEnd()                              â”‚
â”‚    ErrorMessage         â†’ _handleError()                                â”‚
â”‚                                                                         â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### _handleRoomJoined()

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _handleRoomJoined(RoomJoinedMessage msg)                   â”‚
â”‚  (ligne 541)                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  state = state.copyWith(                                    â”‚
â”‚    roomCode: msg.roomCode,                                  â”‚
â”‚    localPlayer: DuelPlayer(                                 â”‚
â”‚      id: msg.playerId,                                      â”‚
â”‚      name: _localPlayerName                                 â”‚
â”‚    ),                                                       â”‚
â”‚    opponent: msg.opponentId != null                         â”‚
â”‚        ? DuelPlayer(id: opponentId, name: opponentName)     â”‚
â”‚        : null,                                              â”‚
â”‚    gameState: DuelGameState.waiting                         â”‚
â”‚  )                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### _handlePlayerJoined()

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _handlePlayerJoined(PlayerJoinedMessage msg)               â”‚
â”‚  (ligne 502)                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  if (msg.playerId != state.localPlayer?.id) {               â”‚
â”‚                                                             â”‚
â”‚    state = state.copyWith(                                  â”‚
â”‚      opponent: DuelPlayer(                                  â”‚
â”‚        id: msg.playerId,                                    â”‚
â”‚        name: msg.playerName                                 â”‚
â”‚      )                                                      â”‚
â”‚    )                                                        â”‚
â”‚                                                             â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  â†’ L'UI affiche maintenant "X a rejoint !"                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### _handleGameStart() â­ CRITIQUE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _handleGameStart(GameStartMessage msg)                                 â”‚
â”‚  (ligne 425)                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  if (msg.puzzleTriple != null) {                                        â”‚
â”‚                                                                         â”‚
â”‚    try {                                                                â”‚
â”‚      final triple = msg.puzzleTriple!                                   â”‚
â”‚                                                                         â”‚
â”‚      // GÃ©nÃ©ration du plateau                                           â”‚
â”‚      final plateau = _generatePlateauFromTriple(triple)                 â”‚
â”‚                          â”‚                                              â”‚
â”‚                          â””â”€â†’ [Voir Phase 4]                             â”‚
â”‚                                                                         â”‚
â”‚      // âœ… MISE Ã€ JOUR DE L'Ã‰TAT AVEC LE PLATEAU                        â”‚
â”‚      state = state.copyWith(                                            â”‚
â”‚        plateau: plateau,                    â† âœ… PLATEAU CRÃ‰Ã‰           â”‚
â”‚        timeRemaining: msg.timeLimit,                                    â”‚
â”‚        placedPieces: [],                                                â”‚
â”‚        gameState: DuelGameState.countdown   â† âœ… Ã‰TAT: COUNTDOWN        â”‚
â”‚      )                                                                  â”‚
â”‚                                                                         â”‚
â”‚    } catch (e) {                                                        â”‚
â”‚      print('[DUEL-ISO] âŒ ERREUR: $e')                                  â”‚
â”‚    }                                                                    â”‚
â”‚                                                                         â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â”‚  â†’ La condition dans WaitingScreen est maintenant vraie !               â”‚
â”‚  â†’ Transition automatique vers GameScreenContent                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### _handleCountdown()

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _handleCountdown(CountdownMessage msg)                     â”‚
â”‚  (ligne 392)                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  if (msg.value == 0) {                                      â”‚
â”‚                                                             â”‚
â”‚    // GO! - DÃ©marrage du jeu                                â”‚
â”‚    state = state.copyWith(                                  â”‚
â”‚      gameState: DuelGameState.playing,  â† âœ… Ã‰TAT: PLAYING  â”‚
â”‚      clearCountdown: true                                   â”‚
â”‚    )                                                        â”‚
â”‚                                                             â”‚
â”‚    _startLocalTimer()  // Timer local pour le temps restant â”‚
â”‚                                                             â”‚
â”‚  } else {                                                   â”‚
â”‚                                                             â”‚
â”‚    // 3, 2, 1...                                            â”‚
â”‚    state = state.copyWith(countdown: msg.value)             â”‚
â”‚                                                             â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Phase 4 : GÃ©nÃ©ration du plateau

### _generatePlateauFromTriple()

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _generatePlateauFromTriple(Map<String, int> triple)                    â”‚
â”‚  (duel_isometry_provider.dart:320)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  EntrÃ©e: { taille: 2, configIndex: 5, solutionNum: 42 }                 â”‚
â”‚                                                                         â”‚
â”‚  1. Extraire les paramÃ¨tres                                             â”‚
â”‚     final taille = triple['taille']                                     â”‚
â”‚     final configIndex = triple['configIndex']                           â”‚
â”‚     final solutionNum = triple['solutionNum']                           â”‚
â”‚                                                                         â”‚
â”‚  2. Charger la configuration Pentoscope                                 â”‚
â”‚     final configsForSize = pentoscopeData[taille]                       â”‚
â”‚     â”‚                                                                   â”‚
â”‚     â””â”€ if (configsForSize == null || configIndex >= length)             â”‚
â”‚           â†’ return Plateau.empty(5, 5)                                  â”‚
â”‚                                                                         â”‚
â”‚  3. Extraire bitmask et nombre de solutions                             â”‚
â”‚     final (bitmask, numSolutions) = configsForSize[configIndex]         â”‚
â”‚                                                                         â”‚
â”‚  4. DÃ©coder le bitmask en IDs de piÃ¨ces                                 â”‚
â”‚     final pieceIds = _bitmaskToIds(bitmask)                             â”‚
â”‚     // Ex: 0x0F3 â†’ [1, 2, 5, 6, 7, 8]                                   â”‚
â”‚                                                                         â”‚
â”‚  5. Obtenir les dimensions du plateau                                   â”‚
â”‚     final (width, height) = _getTaillePlateau(taille)                   â”‚
â”‚     â”‚                                                                   â”‚
â”‚     â”œâ”€ taille 0 â†’ (5, 3)  // 3Ã—5 = 15 cases = 3 piÃ¨ces                  â”‚
â”‚     â”œâ”€ taille 1 â†’ (5, 4)  // 4Ã—5 = 20 cases = 4 piÃ¨ces                  â”‚
â”‚     â””â”€ taille 2 â†’ (5, 5)  // 5Ã—5 = 25 cases = 5 piÃ¨ces                  â”‚
â”‚                                                                         â”‚
â”‚  6. RÃ©cupÃ©rer les objets Pento                                          â”‚
â”‚     for (final id in pieceIds) {                                        â”‚
â”‚       selectedPieces.add(pentominos[id - 1])                            â”‚
â”‚     }                                                                   â”‚
â”‚                                                                         â”‚
â”‚  7. RÃ©soudre avec PentoscopeSolver                                      â”‚
â”‚     final solver = PentoscopeSolver(                                    â”‚
â”‚       width: width,                                                     â”‚
â”‚       height: height,                                                   â”‚
â”‚       pieces: selectedPieces,                                           â”‚
â”‚       maxSeconds: 5                                                     â”‚
â”‚     )                                                                   â”‚
â”‚     final solution = solver.findSolution()                              â”‚
â”‚     â”‚                                                                   â”‚
â”‚     â””â”€ if (solution == null)                                            â”‚
â”‚           â†’ return Plateau.empty(width, height)                         â”‚
â”‚                                                                         â”‚
â”‚  8. Convertir en Plateau                                                â”‚
â”‚     final plateau = _convertToPlateau(width, height, solution)          â”‚
â”‚                                                                         â”‚
â”‚  9. return plateau                                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Phase 5 : Affichage du jeu

### DuelIsometryGameScreen.build()

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DuelIsometryGameScreen.build()                                         â”‚
â”‚  (duel_isometry_game_screen.dart)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  final gameState = ref.watch(duelIsometryProvider)                      â”‚
â”‚  final notifier = ref.read(duelIsometryProvider.notifier)               â”‚
â”‚                                                                         â”‚
â”‚  _updatePlacementsFromState(gameState)                                  â”‚
â”‚                                                                         â”‚
â”‚  final isPlaying = gameState.gameState == DuelGameState.playing         â”‚
â”‚  final plateau = gameState.plateau                                      â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  if (plateau == null) {                                         â”‚    â”‚
â”‚  â”‚    return Scaffold(                                             â”‚    â”‚
â”‚  â”‚      body: Center(child: CircularProgressIndicator())           â”‚    â”‚
â”‚  â”‚    )                                                            â”‚    â”‚
â”‚  â”‚  }                                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  return Scaffold(                                                       â”‚
â”‚    appBar: AppBar(title: "Duel IsomÃ©tries", timer),                     â”‚
â”‚    body: isPlaying                                                      â”‚
â”‚        ? _buildPlayingState(gameState, plateau, notifier)               â”‚
â”‚        : _buildGameState(gameState)                                     â”‚
â”‚  )                                                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### _buildGameState() - Ã‰tats non-playing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _buildGameState(DuelIsometryState state)                   â”‚
â”‚  (ligne 114)                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  switch (state.gameState) {                                 â”‚
â”‚                                                             â”‚
â”‚    case DuelGameState.countdown:                            â”‚
â”‚      return _buildCountdown(state)                          â”‚
â”‚      // Affiche "3", "2", "1", "GO!" en grand               â”‚
â”‚                                                             â”‚
â”‚    case DuelGameState.ended:                                â”‚
â”‚      return _buildGameEnd(state)                            â”‚
â”‚      // Affiche gagnant et scores                           â”‚
â”‚                                                             â”‚
â”‚    case DuelGameState.waiting:                              â”‚
â”‚      return _buildWaiting(state)                            â”‚
â”‚      // CircularProgressIndicator                           â”‚
â”‚                                                             â”‚
â”‚    default:                                                 â”‚
â”‚      return CircularProgressIndicator()                     â”‚
â”‚                                                             â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### _buildPlayingState() â­ Ã‰CRAN PRINCIPAL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _buildPlayingState(gameState, plateau, notifier)                       â”‚
â”‚  (ligne 128)                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  return Column([                                                        â”‚
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  HEADER SCORES                                              â”‚      â”‚
â”‚    â”‚  Container(color: Colors.blue.shade50)                      â”‚      â”‚
â”‚    â”‚                                                             â”‚      â”‚
â”‚    â”‚  Row([                                                      â”‚      â”‚
â”‚    â”‚    Column([                                                 â”‚      â”‚
â”‚    â”‚      "${localPlayer.name}",                                 â”‚      â”‚
â”‚    â”‚      "$_localScore"                                         â”‚      â”‚
â”‚    â”‚    ]),                                                      â”‚      â”‚
â”‚    â”‚    Column([                                                 â”‚      â”‚
â”‚    â”‚      "PiÃ¨ces",                                              â”‚      â”‚
â”‚    â”‚      "${_myPlacedPieces.length}/12"                         â”‚      â”‚
â”‚    â”‚    ]),                                                      â”‚      â”‚
â”‚    â”‚    Column([                                                 â”‚      â”‚
â”‚    â”‚      "${opponent.name}",                                    â”‚      â”‚
â”‚    â”‚      "$_opponentScore"                                      â”‚      â”‚
â”‚    â”‚    ])                                                       â”‚      â”‚
â”‚    â”‚  ])                                                         â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  PLATEAU                                                    â”‚      â”‚
â”‚    â”‚  Expanded(                                                  â”‚      â”‚
â”‚    â”‚    SingleChildScrollView(                                   â”‚      â”‚
â”‚    â”‚      DuelIsometryPlateau(                                   â”‚      â”‚
â”‚    â”‚        solutionPlateau: plateau,                            â”‚      â”‚
â”‚    â”‚        myPlacedPieces: _myPlacedPieces,                     â”‚      â”‚
â”‚    â”‚        opponentPlacedPieces: _opponentPlacedPieces,         â”‚      â”‚
â”‚    â”‚        isEnabled: true,                                     â”‚      â”‚
â”‚    â”‚        onCellTapped: (x, y) {                               â”‚      â”‚
â”‚    â”‚          if (_selectedPieceId != null) {                    â”‚      â”‚
â”‚    â”‚            _tryPlacePiece(notifier, plateau,                â”‚      â”‚
â”‚    â”‚                          _selectedPieceId, x, y,            â”‚      â”‚
â”‚    â”‚                          _selectedOrientation)              â”‚      â”‚
â”‚    â”‚          }                                                  â”‚      â”‚
â”‚    â”‚        }                                                    â”‚      â”‚
â”‚    â”‚      )                                                      â”‚      â”‚
â”‚    â”‚    )                                                        â”‚      â”‚
â”‚    â”‚  )                                                          â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  SÃ‰LECTEUR DE PIÃˆCES                                        â”‚      â”‚
â”‚    â”‚  Container(                                                 â”‚      â”‚
â”‚    â”‚    height: 200,                                             â”‚      â”‚
â”‚    â”‚    color: Colors.grey.shade100,                             â”‚      â”‚
â”‚    â”‚    child: DuelIsometryPieceSlider(                          â”‚      â”‚
â”‚    â”‚      myPlacedPieces: _myPlacedPieces,                       â”‚      â”‚
â”‚    â”‚      opponentPlacedPieces: _opponentPlacedPieces,           â”‚      â”‚
â”‚    â”‚      selectedPieceId: _selectedPieceId,                     â”‚      â”‚
â”‚    â”‚      isEnabled: true,                                       â”‚      â”‚
â”‚    â”‚      onPieceSelected: (pieceId, orientation) {              â”‚      â”‚
â”‚    â”‚        setState(() {                                        â”‚      â”‚
â”‚    â”‚          _selectedPieceId = pieceId;                        â”‚      â”‚
â”‚    â”‚          _selectedOrientation = orientation;                â”‚      â”‚
â”‚    â”‚        });                                                  â”‚      â”‚
â”‚    â”‚      }                                                      â”‚      â”‚
â”‚    â”‚    )                                                        â”‚      â”‚
â”‚    â”‚  )                                                          â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                         â”‚
â”‚  ])                                                                     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Widgets finaux

### DuelIsometryPlateau

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DuelIsometryPlateau                                                    â”‚
â”‚  (duel_isometry_plateau.dart)                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Props:                                                                 â”‚
â”‚  - solutionPlateau: Plateau (grille avec pieceIds)                      â”‚
â”‚  - myPlacedPieces: Map<int, (x, y, orientation)>                        â”‚
â”‚  - opponentPlacedPieces: Map<int, (x, y, orientation)>                  â”‚
â”‚  - onCellTapped: (int x, int y) â†’ void                                  â”‚
â”‚  - isEnabled: bool                                                      â”‚
â”‚                                                                         â”‚
â”‚  Rendu:                                                                 â”‚
â”‚  - GridView.builder avec width Ã— height cellules                        â”‚
â”‚  - Chaque cellule:                                                      â”‚
â”‚    - MouseRegion (hover)                                                â”‚
â”‚    - GestureDetector (tap)                                              â”‚
â”‚    - Container avec couleur selon Ã©tat                                  â”‚
â”‚                                                                         â”‚
â”‚  Couleurs:                                                              â”‚
â”‚  - Blanc: cellule vide ou piÃ¨ce placÃ©e                                  â”‚
â”‚  - Gris 15%: cellule de la solution (non placÃ©e)                        â”‚
â”‚  - Bordure violette: hover                                              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DuelIsometryPieceSlider

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DuelIsometryPieceSlider                                                â”‚
â”‚  (duel_isometry_piece_slider.dart)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Props:                                                                 â”‚
â”‚  - myPlacedPieces: Map<int, (x, y, orientation)>                        â”‚
â”‚  - opponentPlacedPieces: Map<int, (x, y, orientation)>                  â”‚
â”‚  - selectedPieceId: int?                                                â”‚
â”‚  - onPieceSelected: (int pieceId, int orientation) â†’ void               â”‚
â”‚  - isEnabled: bool                                                      â”‚
â”‚                                                                         â”‚
â”‚  Structure:                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Row 1: PiÃ¨ces 1-6                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                      â”‚    â”‚
â”‚  â”‚  â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚                                      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                      â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  Row 2: PiÃ¨ces 7-12                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                      â”‚    â”‚
â”‚  â”‚  â”‚ 7 â”‚ 8 â”‚ 9 â”‚10 â”‚11 â”‚12 â”‚                                      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                      â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  [Bouton TOURNER] (si piÃ¨ce sÃ©lectionnÃ©e)                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  Chaque carte affiche:                                                  â”‚
â”‚  - NumÃ©ro de piÃ¨ce (1-12)                                               â”‚
â”‚  - Orientation actuelle (O0, O1, O2...)                                 â”‚
â”‚  - Nombre d'isomÃ©tries (Â±N)                                             â”‚
â”‚  - IcÃ´nes si placÃ©e (âœ“ bleu = moi, ğŸ‘¤ rouge = adversaire)               â”‚
â”‚                                                                         â”‚
â”‚  Couleurs de fond:                                                      â”‚
â”‚  - Gris clair: disponible                                               â”‚
â”‚  - Bleu 30%: placÃ©e par moi                                             â”‚
â”‚  - Rouge 30%: placÃ©e par adversaire                                     â”‚
â”‚  - Mix: placÃ©e par les deux                                             â”‚
â”‚                                                                         â”‚
â”‚  Bordure:                                                               â”‚
â”‚  - Violette Ã©paisse: sÃ©lectionnÃ©e                                       â”‚
â”‚  - Bleue: placÃ©e par moi                                                â”‚
â”‚  - Rouge: placÃ©e par adversaire                                         â”‚
â”‚  - Grise: disponible                                                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Tableau rÃ©capitulatif des Ã©tats

| Phase | `gameState` | `plateau` | `opponent` | Ã‰cran affichÃ© |
|-------|-------------|-----------|------------|---------------|
| 1. Join | `waiting` | `null` | `null` | WaitingScreen (attente) |
| 2. Adversaire rejoint | `waiting` | `null` | `âœ“` | WaitingScreen ("X a rejoint") |
| 3. GameStart reÃ§u | `countdown` | `âœ“` | `âœ“` | GameScreen â†’ _buildCountdown |
| 4. Countdown 3â†’2â†’1 | `countdown` | `âœ“` | `âœ“` | "3", "2", "1" |
| 5. Countdown = 0 | `playing` | `âœ“` | `âœ“` | GameScreen â†’ _buildPlayingState |
| 6. Fin de partie | `ended` | `âœ“` | `âœ“` | GameScreen â†’ _buildGameEnd |

---

## ğŸ”— Diagramme de sÃ©quence simplifiÃ©

```
User          JoinScreen       Provider        WebSocket       Server
  â”‚               â”‚               â”‚               â”‚               â”‚
  â”‚â”€â”€[code+name]â”€â”€â–º               â”‚               â”‚               â”‚
  â”‚               â”‚â”€â”€joinRoom()â”€â”€â”€â–º               â”‚               â”‚
  â”‚               â”‚               â”‚â”€â”€HTTP GETâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€{exists: true}â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â”€â”€connect()â”€â”€â”€â”€â–º               â”‚
  â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€connectedâ”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â”€â”€JoinRoomâ”€â”€â”€â”€â”€â–ºâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚               â”‚â—„â”€â”€trueâ”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚
  â”‚               â”‚                               â”‚               â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€Navigator.push(WaitingScreen)                â”‚
  â”‚               â”‚               â”‚               â”‚               â”‚
  â”‚               â”‚               â”‚â—„â”€â”€RoomJoinedâ”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â—„â”€â”€PlayerJoinedâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â—„â”€â”€GameStartâ”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚  (puzzleTriple)               â”‚
  â”‚               â”‚               â”‚               â”‚               â”‚
  â”‚               â”‚               â”‚â”€â”€generatePlateau()            â”‚
  â”‚               â”‚               â”‚  state.plateau = plateau      â”‚
  â”‚               â”‚               â”‚  state.gameState = countdown  â”‚
  â”‚               â”‚               â”‚               â”‚               â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (rebuild avec plateau)       â”‚
  â”‚  [GameScreen avec plateau + sÃ©lecteur]        â”‚               â”‚
  â”‚               â”‚               â”‚               â”‚               â”‚
  â”‚               â”‚               â”‚â—„â”€â”€Countdown(3)â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â—„â”€â”€Countdown(2)â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â—„â”€â”€Countdown(1)â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚â—„â”€â”€Countdown(0)â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚               â”‚  state.gameState = playing    â”‚
  â”‚               â”‚               â”‚               â”‚               â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  [JEU EN COURS]               â”‚
  â”‚               â”‚               â”‚               â”‚               â”‚
```

---

## ğŸ“ Notes importantes

1. **Transition automatique** : Le passage de WaitingScreen Ã  GameScreen se fait automatiquement grÃ¢ce au `ref.watch()` qui reconstruit l'UI quand `state.plateau` devient non-null ET `gameState` passe Ã  countdown/playing.

2. **GÃ©nÃ©ration locale** : Le plateau est gÃ©nÃ©rÃ© **localement** par chaque client Ã  partir du `puzzleTriple` envoyÃ© par le serveur. Cela garantit que les deux joueurs ont exactement le mÃªme plateau.

3. **Ã‰tat local vs serveur** : 
   - `_myPlacedPieces` et `_opponentPlacedPieces` sont gÃ©rÃ©s localement dans le widget
   - `state.placedPieces` vient du serveur via WebSocket

4. **SÃ©lecteur de piÃ¨ces** : Le widget `DuelIsometryPieceSlider` gÃ¨re sa propre map d'orientations (`pieceOrientations`) pour permettre la rotation avant placement.

